<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>큐마켓 관리자</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: sans-serif;
        }

        table {
            width: 100%;
        }

        img {
            width: 75px;
            height: 75px;
        }

        table,
        tr,
        td,
        th {
            border-collapse: collapse;
        }

        thead {
            background-color: #F0F0F0;
        }

        th {
            padding: 10px 0px;
        }

        td {
            padding: 10px 0px;
            text-align: center;
        }

        tbody tr {
            border-bottom: 1px solid #F0F0F0;
        }
        .page_num {
            width : 99.5%;   
            position: relative;
            bottom: 0;
        }
        .page_num, a {  
            text-align: center;
            text-decoration: none;
        }
        .a_other_page {
            color: #646464;
		}
        .a_current_page {
            font-size: 150%;
            color: black;
            pointer-events: none;
		}

        @media screen and (max-width: 768px) {
            * {
                font-size: 0.9em;
            }

            td:nth-child(5) {
                width: 60px;
            }

            .product_list td:nth-child(1) {
                width: 50px;
                word-break: break-all;
            }
        }
    </style>
</head>

<body>
    <table>
        <thead>
            <tr>
                <th>
                    수령인
                </th>
                <th>
                    쿠폰 할인
                </th>
                <th>
                    큐머니 할인
                </th>
                <th>
                    배송 금액
                </th>
                <th>
                    실 결제 금액
                </th>
                <th>
                    주문 시간
                </th>
                <th>
                    주문상품
                </th>
            </tr>
        </thead>
        <tbody>
            <%
            const offset = new Date().getTimezoneOffset() * 60000; 
            for(let i=0;i < data.orders.length; i++) { %>
            <tr>
                <td>
                    <%= data.orders[i].receiver %>
                </td>
                <td>
                    <%= data.orders[i].coupon_price %>원
                </td>
                <td>
                    <%= data.orders[i].qmoney %>원
                </td>
                <td>
                    <%= data.orders[i].delivery_price %>원
                </td>
                <td>
                    <%= data.orders[i].payment %>원
                </td>
                <td>
                    <%= data.orders[i].order_date %>
                </td>
                <td>
                    <table class="product_list">
                        <tbody>
                            <%
                                for(var j=0; j < data.orders[i].product.length; j++){ %>
                            <tr>
                                <td>
                                    <%=data.orders[i].product[j].name %>
                                </td>
                                <td>
                                    <%=data.orders[i].product[j].count %>개
                                </td>
                                <td>
                                    <%=data.orders[i].product[j].price%>원
                                </td>
                            </tr>
                            <% } %>
                        </tbody>
                    </table>
                </td>
            </tr>
            <% } %>
        </tbody>
    </table>
    <!-- move 추가 필요 -->
    <div class = "page_num">
     <% var current_page = data.current_page_num;
        var last_page = data.last_page_num;
        if(current_page < 6){
            if(last_page < 10){
                for(let i = 1; i <= last_page; i++){
                    if(i == current_page){ %>
                        <a href="#" class = "a_current_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                            <%= i %>
                        </a>
     <%             } else { %>
                        <a href="#" class = "a_other_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                            <%= i %>
                        </a>
     <%             }
                }
            } else {
                for(let i = 1; i <= 10; i++){ 
                    if(i == current_page){ %>
                        <a href="#" class = "a_current_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                            <%= i %>
                        </a>
     <%             } else { %>
                        <a href="#" class = "a_other_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                            <%= i %>
                        </a>
     <%             }
                }
            }
        } else if(last_page - current_page < 4){
            for(let i = 0; i < 10; i++){
                if(last_page - 9 + i < 1){}
                else { 
                    if(last_page - 9 + i == current_page){ %>
                        <a href="#" class = "a_current_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                            <%= last_page - 9 + i %>
                        </a>
     <%             } else { %>
                        <a href="#" class = "a_other_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                            <%= last_page - 9 + i %>
                        </a>
     <%             }
                }
            }
        } else {
            for(let i = 0; i < 10; i++){
                if(current_page - 5 + i == current_page){ %>
                    <a href="#" class = "a_current_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                        <%= current_page - 5 + i %>
                    </a>
     <%         } else { %>
                    <a href="#" class = "a_other_page" onclick="move_page('<%= data.partner_idx %>', '<%= data.option.current_status %>', this)">
                        <%= current_page - 5 + i %>
                    </a>
     <%         }
            }
        } %>
    </div>
    <script>
        function exportTable(myTable) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:application/vnd.ms-excel,' + encodeURIComponent(myTable.outerHTML));
            element.setAttribute('download', 'product_payment');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }
        function move_page(partner_id, status, a_tag){
            var num = a_tag.text.replace(/(\s*)/g, "")
            var URL = "/manager/" + partner_id + "/payment?page=" + num + "&status=" + status;
            console.log(URL)
            var xhttp = new XMLHttpRequest()
            xhttp.onreadystatechange = function() {
                if(this.readyState == 4 && this.status == 200) {
                    window.location.href = xhttp.responseURL;
                }
            }
            xhttp.open("GET", URL)
            xhttp.setRequestHeader("Content-Type", "application/json")
            xhttp.send();
        }
    </script>
</body>

</html>
